<!-- ğŸ”Š Hidden audio -->
<audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script>
  let audioAllowed = false;

  // ğŸ—“ï¸ Check if user already enabled audio today
  function checkAudioPermission() {
    const today = new Date().toISOString().slice(0, 10); // e.g. "2025-07-02"
    const lastAllowed = localStorage.getItem("audioEnabledDate");
    if (lastAllowed === today) {
      audioAllowed = true;
      return;
    }

    // ğŸ‘† Wait for user tap once to enable audio
    function enableAudio() {
      const audio = document.getElementById("alertSound");
      audio.play().catch(() => {}); // try to unlock autoplay
      audio.pause();
      audioAllowed = true;
      localStorage.setItem("audioEnabledDate", today);
      console.log("ğŸ”“ Audio unlocked for today");

      document.removeEventListener("click", enableAudio);
      document.removeEventListener("touchstart", enableAudio);
    }

    document.addEventListener("click", enableAudio);
    document.addEventListener("touchstart", enableAudio);
  }

  checkAudioPermission();

  // ğŸ”” Function to play beep + voice
  function playAlert(signalName) {
    if (!audioAllowed) return;

    // ğŸ”Š Beep
    const beep = document.getElementById("alertSound");
    beep.currentTime = 0;
    beep.play().catch(() => {});

    // ğŸ—£ï¸ Speak Signal Name
    const msg = new SpeechSynthesisUtterance(signalName + " Signal Activated");
    msg.lang = "en-IN";
    msg.volume = 1;
    msg.pitch = 1;
    msg.rate = 0.85;
    speechSynthesis.cancel();
    speechSynthesis.speak(msg);
  }
</script>
